Creation date: 12.06.2024
Links:

---

Заметка представляет собой конспект книги "The Little Book Of Semaphores".

# Семафоры
Семафор - примитив синхронизации, изобретенный Эдрагом Дейкстрой; структура данных, хранящая счетчик, который инициализируется при создании семафора; определяет две операции:
- Wait - разбудить один ожидающмй поток, если он есть, и увеличить внутренний счетчик на единицу
- Signal - уменьшить счетчик на единицу; уснуть, если счетчик отрицательный

```c++
S = Semaphore(N)

S.Wait()
S.Signal()
```

# Паттерны синхронизации
## Мьютекс
Mutex (mutual exclusion) - примитив синхронизации, обеспечивающий эксклюзивный доступ к критической секции кода. 

Реализация :
```c++
mutex = Semaphore(1)

mutex.Wait()
    critical section
mutex.Signal()
```

## Мультиплекс
Мультиплех - примитив синхронизации, являющийся разновидностью мьютекса, обеспечивающий доступ к критической секции только для N потоков одновременно. 

Реализация:
```c++
multiplex = Semaphore(N)

multiplex.Wait()
    critical section
multiplex.Signal()
```

## Барьер
Барьер - примитив синхронизации, позволяющий обеспечить ситуацию, когда критическая секция не исполняется до тех пор, пока N потоков не дойдут до точки рандеву.

Реализация:
```c++
rendezvous

mutex.Wait()
    count++
mutex.Signal()

if count == N:
    turnstile.Signal()

turnstile.Wait()
turnstile.Signal()

critical section
```
Здесь N - кол-во потоков, необходимых для открытия барьера.

Turnstile (турникет) - механизм сихронизации, который изначально находится в заблокированном состоянии, а когда разблокируется, пропускает все потоки

## Переиспользуемый барьер
Так как реализация механизма барьера подразумевает, что турникет остается в разблокированном состояни, то это значит, что повторное использование такого барьера невозможно.

Переиспользуемый барьер отличается от обычного тем, что состоит из двух турникетов, внутри которых расположена критическая секция.

Реализация:
```c++
rendezvous

mutex.Wait()
    count++
    if count == N:
        turnstile2.Wait()
        turnstile1.Signal()
mutex.Signal()

turnstile1.Wait()
turnstile1.Signal()

critical point

mutex.Wait()
    count--
    if count == 0:
        turnstile1.Wait()
        turnstile2.Signal()
mutex.Signal()

turnstile2.Wait()
turnstile2.Signal()
```